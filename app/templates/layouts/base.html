<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% if title %}
    <title>{{ title }} - E-Voting</title>
    {% else %}
    <title>Welcome to E-Voting</title>
    {% endif %}

</head>

<body class="{{ styles }}">
    <div>Evoting: <a href="{{ url_for('index') }}">Home</a>, {% if current_user.is_authenticated %}
        <a href="{{ url_for('dashboard') }}">Dashboard</a>
        {% endif %}
        {% if current_user.is_anonymous %}
        <div>
            <button onclick="login()">Login</button>
        </div>
        {% else %}
        <div>
            <button onclick="logout()">Logout</button>
        </div>
        {% endif %}

        {% if current_user.is_authenticated %}
        <div>
            Hello, {{ current_user.email.split("@")[0].split(".")[0] }}
        </div>
        {% endif %}
    </div>
    <hr>
    {% block content %}{% endblock %}

    <script src="https://auther.mybubbl.me/js/auth.js?v=0.2.0"></script>
    <script>
        var login = function () {
            var Auth = new BubblAuth('https://auther.mybubbl.me');

            Auth.login()
                .then((data) => {
                    console.log('Authenticated successfully! => ' + data);
                    // after successful login, tell the server.
                    //
                    window.location = `/login-complete?user=${data}&token=correct2021`;
                })
                .catch((err) => {
                    console.error('Error logging in! Try again?', err);
                    document.getElementById('error-notif').style.display = 'block';
                });
        };

        var logout = function () {
            var Auth = new BubblAuth('https://auther.mybubbl.me');

            Auth.logout()
                .then((data) => {
                    console.log('Logged out successfully! => ' + data);
                    // after successful logout, tell the server.
                    //
                    window.location = `/logout-complete?user=${data}&token=correct2021`;
                })
                .catch((err) => {
                    console.error('Error logging in! Try again?', err);
                    document.getElementById('error-notif').style.display = 'block';
                });
        };
    </script>
</body>

</html>